/*
 * üì± Chatbot Widget - Responsive Design (Mobile-First)
 *
 * Design responsive e mobile-first per tutti i dispositivi:
 * - Breakpoints consistenti
 * - Touch-friendly interactions
 * - Adaptive typography
 * - Performance optimizations
 * - Cross-device compatibility
 */

/* =================================================================
   üìè RESPONSIVE BREAKPOINTS & VARIABLES
   ================================================================= */

:root {
  /* Breakpoints */
  --chatbot-breakpoint-xs: 320px;  /* Small phones */
  --chatbot-breakpoint-sm: 480px;  /* Large phones */
  --chatbot-breakpoint-md: 768px;  /* Tablets */
  --chatbot-breakpoint-lg: 1024px; /* Small laptops */
  --chatbot-breakpoint-xl: 1280px; /* Large laptops */
  --chatbot-breakpoint-xxl: 1536px; /* Desktops */
  
  /* Responsive spacing */
  --chatbot-spacing-mobile: 12px;
  --chatbot-spacing-tablet: 16px;
  --chatbot-spacing-desktop: 20px;
  
  /* Responsive font sizes */
  --chatbot-font-size-base-mobile: 14px;
  --chatbot-font-size-base-tablet: 15px;
  --chatbot-font-size-base-desktop: 16px;
  
  /* Widget dimensions */
  --chatbot-widget-width-mobile: 100vw;
  --chatbot-widget-width-tablet: 400px;
  --chatbot-widget-width-desktop: 380px;
  
  --chatbot-widget-height-mobile: 100vh;
  --chatbot-widget-height-tablet: 600px;
  --chatbot-widget-height-desktop: 500px;
  
  /* Touch targets */
  --chatbot-touch-target-min: 44px;
  --chatbot-touch-target-comfortable: 48px;
  --chatbot-touch-target-large: 56px;
}

/* =================================================================
   üì± MOBILE-FIRST BASE STYLES (320px+)
   ================================================================= */

/* Container mobile-first */
.chatbot-container {
  /* Mobile defaults */
  width: var(--chatbot-widget-width-mobile);
  height: var(--chatbot-widget-height-mobile);
  max-width: 100vw;
  max-height: 100vh;
  bottom: 0;
  right: 0;
  left: 0;
  top: 0;
  border-radius: 0;
  
  /* Mobile-optimized transforms */
  transform-origin: center bottom;
  
  /* Performance optimizations */
  will-change: transform, opacity;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

.chatbot-container.open {
  transform: scale(1) translateZ(0);
}

/* FAB mobile positioning */
.chatbot-fab {
  bottom: var(--chatbot-spacing-mobile);
  right: var(--chatbot-spacing-mobile);
  width: var(--chatbot-touch-target-large);
  height: var(--chatbot-touch-target-large);
  
  /* Mobile-friendly shadow */
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* Header mobile styles */
.chatbot-header {
  padding: var(--chatbot-spacing-mobile);
  min-height: var(--chatbot-touch-target-comfortable);
}

.chatbot-header-title {
  font-size: 1rem;
  gap: var(--chatbot-spacing-mobile);
}

.chatbot-header-avatar {
  width: 28px;
  height: 28px;
  font-size: 0.875rem;
}

.chatbot-close-button {
  min-width: var(--chatbot-touch-target-min);
  min-height: var(--chatbot-touch-target-min);
  padding: var(--chatbot-spacing-mobile);
}

/* Messages area mobile */
.chatbot-messages {
  padding: var(--chatbot-spacing-mobile);
  gap: var(--chatbot-spacing-mobile);
  font-size: var(--chatbot-font-size-base-mobile);
  
  /* Mobile scroll optimizations */
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
}

.chatbot-message {
  max-width: 90%;
}

.chatbot-message-bubble {
  padding: var(--chatbot-spacing-mobile);
  font-size: var(--chatbot-font-size-base-mobile);
  line-height: 1.5;
  
  /* Word wrapping for mobile */
  word-wrap: break-word;
  overflow-wrap: break-word;
  hyphens: auto;
}

/* Input area mobile */
.chatbot-input-area {
  padding: var(--chatbot-spacing-mobile);
  gap: var(--chatbot-spacing-mobile);
  
  /* Safe area for mobile notches */
  padding-bottom: max(var(--chatbot-spacing-mobile), env(safe-area-inset-bottom));
}

.chatbot-input {
  min-height: var(--chatbot-touch-target-min);
  padding: var(--chatbot-spacing-mobile);
  font-size: var(--chatbot-font-size-base-mobile);
  border-radius: 22px; /* More rounded for mobile */
  
  /* Mobile keyboard optimizations */
  -webkit-appearance: none;
  appearance: none;
}

.chatbot-send-button {
  min-width: var(--chatbot-touch-target-min);
  min-height: var(--chatbot-touch-target-min);
  width: var(--chatbot-touch-target-min);
  height: var(--chatbot-touch-target-min);
  border-radius: 50%;
}

/* =================================================================
   üì± SMALL PHONES (320px - 479px)
   ================================================================= */

@media (max-width: 479px) {
  .chatbot-header {
    padding: 10px var(--chatbot-spacing-mobile);
  }
  
  .chatbot-header-title {
    font-size: 0.9rem;
  }
  
  .chatbot-messages {
    padding: 8px var(--chatbot-spacing-mobile);
  }
  
  .chatbot-message-bubble {
    padding: 10px var(--chatbot-spacing-mobile);
    font-size: 13px;
  }
  
  .chatbot-input {
    font-size: 16px; /* Prevent zoom on iOS */
  }
  
  /* Compact citations for small screens */
  .chatbot-citations {
    padding: 8px;
    margin-top: 8px;
  }
  
  .chatbot-citation {
    padding: 6px;
  }
  
  .chatbot-citation-snippet {
    font-size: 11px;
    -webkit-line-clamp: 2;
  }
}

/* =================================================================
   üì± LARGE PHONES (480px - 767px)
   ================================================================= */

@media (min-width: 480px) {
  .chatbot-container {
    width: var(--chatbot-widget-width-tablet);
    height: var(--chatbot-widget-height-tablet);
    max-width: calc(100vw - 32px);
    max-height: calc(100vh - 32px);
    bottom: 16px;
    right: 16px;
    left: auto;
    top: auto;
    border-radius: var(--chatbot-border-radius-lg);
  }
  
  .chatbot-fab {
    bottom: 20px;
    right: 20px;
  }
  
  .chatbot-header {
    padding: var(--chatbot-spacing-tablet);
  }
  
  .chatbot-messages {
    padding: var(--chatbot-spacing-tablet);
    font-size: var(--chatbot-font-size-base-tablet);
  }
  
  .chatbot-message-bubble {
    font-size: var(--chatbot-font-size-base-tablet);
  }
  
  .chatbot-input-area {
    padding: var(--chatbot-spacing-tablet);
  }
  
  .chatbot-input {
    font-size: var(--chatbot-font-size-base-tablet);
  }
}

/* =================================================================
   üíª TABLETS (768px - 1023px)
   ================================================================= */

@media (min-width: 768px) {
  .chatbot-container {
    width: var(--chatbot-widget-width-desktop);
    height: var(--chatbot-widget-height-desktop);
    max-width: 420px;
    max-height: 600px;
  }
  
  .chatbot-fab {
    width: var(--chatbot-touch-target-large);
    height: var(--chatbot-touch-target-large);
  }
  
  .chatbot-messages {
    font-size: var(--chatbot-font-size-base-desktop);
  }
  
  .chatbot-message-bubble {
    font-size: var(--chatbot-font-size-base-desktop);
    padding: var(--chatbot-spacing-tablet) var(--chatbot-spacing-desktop);
  }
  
  .chatbot-input {
    font-size: var(--chatbot-font-size-base-desktop);
  }
  
  /* Better citations layout for tablets */
  .chatbot-citations {
    padding: var(--chatbot-spacing-tablet);
  }
  
  .chatbot-citation-header {
    flex-direction: row;
    align-items: center;
  }
  
  .chatbot-citation-snippet {
    margin-left: calc(1.25rem + var(--chatbot-spacing-sm));
    -webkit-line-clamp: 3;
  }
}

/* =================================================================
   üñ•Ô∏è DESKTOP (1024px+)
   ================================================================= */

@media (min-width: 1024px) {
  .chatbot-container {
    max-width: 400px;
    max-height: 550px;
  }
  
  .chatbot-fab {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  
  .chatbot-fab:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
  }
  
  .chatbot-messages {
    padding: var(--chatbot-spacing-desktop);
  }
  
  .chatbot-input-area {
    padding: var(--chatbot-spacing-desktop);
  }
  
  /* Desktop hover effects */
  .chatbot-send-button:hover {
    transform: scale(1.05);
  }
  
  .chatbot-citation:hover {
    transform: translateY(-1px);
  }
}

/* =================================================================
   üñ•Ô∏è LARGE DESKTOP (1280px+)
   ================================================================= */

@media (min-width: 1280px) {
  .chatbot-container {
    max-width: 420px;
    max-height: 600px;
  }
  
  .chatbot-fab {
    bottom: 24px;
    right: 24px;
  }
}

/* =================================================================
   üìê VIEWPORT ORIENTATION
   ================================================================= */

/* Portrait orientation optimizations */
@media (orientation: portrait) and (max-width: 768px) {
  .chatbot-container {
    height: 100vh;
    height: 100dvh; /* Dynamic viewport height when supported */
  }
  
  .chatbot-messages {
    flex: 1;
    min-height: 0; /* Allow flex shrinking */
  }
}

/* Landscape orientation on mobile */
@media (orientation: landscape) and (max-height: 500px) {
  .chatbot-container {
    height: 100vh;
    max-height: 100vh;
  }
  
  .chatbot-header {
    padding: 8px var(--chatbot-spacing-mobile);
    min-height: 40px;
  }
  
  .chatbot-header-title {
    font-size: 0.9rem;
  }
  
  .chatbot-header-avatar {
    width: 24px;
    height: 24px;
  }
  
  .chatbot-messages {
    padding: 8px var(--chatbot-spacing-mobile);
  }
  
  .chatbot-input-area {
    padding: 8px var(--chatbot-spacing-mobile);
  }
}

/* =================================================================
   ‚ö° PERFORMANCE OPTIMIZATIONS
   ================================================================= */

/* GPU acceleration for animations */
.chatbot-container,
.chatbot-fab,
.chatbot-message {
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
}

/* Optimize scrolling performance */
.chatbot-messages {
  contain: layout style paint;
  overflow-anchor: auto;
}

/* Reduce paint on scroll */
.chatbot-message-bubble {
  contain: layout paint;
}

/* Optimize touch interactions */
@media (hover: none) and (pointer: coarse) {
  .chatbot-fab,
  .chatbot-send-button,
  .chatbot-close-button,
  .chatbot-citation-title {
    /* Remove hover effects on touch devices */
    transition: background-color 0.15s ease;
  }
  
  .chatbot-fab:hover,
  .chatbot-send-button:hover,
  .chatbot-citation:hover {
    transform: none;
  }
  
  /* Enhanced touch feedback */
  .chatbot-fab:active,
  .chatbot-send-button:active {
    transform: scale(0.95);
  }
}

/* =================================================================
   üì± DEVICE-SPECIFIC OPTIMIZATIONS
   ================================================================= */

/* iOS Safari optimizations */
@supports (-webkit-touch-callout: none) {
  .chatbot-input {
    /* Prevent zoom on focus */
    font-size: 16px;
  }
  
  .chatbot-container {
    /* Account for iOS safe areas */
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }
  
  .chatbot-messages {
    /* Improve scroll momentum */
    -webkit-overflow-scrolling: touch;
  }
}

/* Android Chrome optimizations */
@media screen and (-webkit-min-device-pixel-ratio: 0) and (min-resolution: 0.001dpcm) {
  .chatbot-input {
    /* Better input handling on Android */
    background-color: var(--chatbot-bg-input);
  }
}

/* =================================================================
   üéØ TOUCH TARGET OPTIMIZATIONS
   ================================================================= */

/* Ensure all interactive elements meet minimum touch target size */
.chatbot-fab,
.chatbot-send-button,
.chatbot-close-button {
  min-width: var(--chatbot-touch-target-min);
  min-height: var(--chatbot-touch-target-min);
}

.chatbot-citation-title {
  min-height: var(--chatbot-touch-target-min);
  padding: 8px 12px;
}

/* Larger touch targets for critical actions */
@media (max-width: 768px) {
  .chatbot-fab {
    width: var(--chatbot-touch-target-large);
    height: var(--chatbot-touch-target-large);
  }
  
  .chatbot-send-button {
    width: var(--chatbot-touch-target-comfortable);
    height: var(--chatbot-touch-target-comfortable);
  }
  
  .chatbot-close-button {
    min-width: var(--chatbot-touch-target-comfortable);
    min-height: var(--chatbot-touch-target-comfortable);
  }
}

/* =================================================================
   üî§ RESPONSIVE TYPOGRAPHY
   ================================================================= */

/* Fluid typography */
.chatbot-container {
  font-size: clamp(
    var(--chatbot-font-size-base-mobile),
    2.5vw,
    var(--chatbot-font-size-base-desktop)
  );
}

/* Scale text based on container size */
@media (min-width: 480px) and (max-width: 767px) {
  .chatbot-message-bubble {
    font-size: calc(var(--chatbot-font-size-base-mobile) + 1px);
  }
}

@media (min-width: 768px) {
  .chatbot-message-bubble {
    font-size: var(--chatbot-font-size-base-desktop);
  }
}

/* =================================================================
   üåê REDUCED DATA & SLOW CONNECTIONS
   ================================================================= */

/* Optimize for slow connections */
@media (prefers-reduced-data: reduce) {
  .chatbot-container,
  .chatbot-fab {
    /* Remove non-essential animations */
    animation: none;
    transition: opacity 0.1s ease;
  }
  
  .chatbot-message {
    /* Reduce transition effects */
    transition: opacity 0.1s ease;
  }
  
  /* Simplify shadows */
  .chatbot-container {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }
  
  .chatbot-fab {
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  }
}

/* =================================================================
   üé® HIGH DPI / RETINA DISPLAYS
   ================================================================= */

@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  .chatbot-container {
    /* Crisp borders on high DPI */
    border-width: 0.5px;
  }
  
  .chatbot-message-bubble {
    /* Sharper text rendering */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
}

/* =================================================================
   üîÑ CONTAINER QUERIES (Future-proofing)
   ================================================================= */

/* When container queries are supported */
@supports (container-type: inline-size) {
  .chatbot-container {
    container-type: inline-size;
  }
  
  /* Responsive design based on container width instead of viewport */
  @container (max-width: 350px) {
    .chatbot-header-title {
      font-size: 0.9rem;
    }
    
    .chatbot-message {
      max-width: 95%;
    }
  }
  
  @container (min-width: 400px) {
    .chatbot-messages {
      padding: var(--chatbot-spacing-desktop);
    }
  }
}
