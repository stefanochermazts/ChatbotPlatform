/**
 * üö® Chatbot Widget - Error Handling & Rate Limiting Styles
 * 
 * Stili per:
 * - Error overlay e messaggi
 * - Rate limiting UI feedback  
 * - Retry mechanisms e countdown
 * - Stati di errore e severit√†
 * - Graceful degradation
 * - Accessibilit√† errori
 * 
 * @version 1.0.0
 * @author Chatbot Platform
 */

/* =================================================================
   üö® ERROR OVERLAY CONTAINER
   ================================================================= */

.chatbot-error-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(4px);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--chatbot-spacing-md, 1rem);
  border-radius: var(--chatbot-border-radius-lg, 0.75rem);
  animation: chatbotErrorFadeIn 0.3s ease-out;
}

@keyframes chatbotErrorFadeIn {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* Reduce motion for accessibility */
@media (prefers-reduced-motion: reduce) {
  .chatbot-error-overlay {
    animation: none;
  }
  
  @keyframes chatbotErrorFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
}

/* =================================================================
   üìã ERROR CONTENT
   ================================================================= */

.chatbot-error-content {
  background: var(--chatbot-bg-card, #ffffff);
  border-radius: var(--chatbot-border-radius-md, 0.5rem);
  padding: var(--chatbot-spacing-lg, 1.5rem);
  max-width: 90%;
  min-width: 280px;
  box-shadow: var(--chatbot-shadow-lg, 0 10px 15px -3px rgba(0, 0, 0, 0.1));
  border: 1px solid var(--chatbot-border-color, #e5e7eb);
  position: relative;
  text-align: center;
}

/* =================================================================
   üé® ERROR SEVERITY LEVELS
   ================================================================= */

/* Low severity - light blue */
.severity-low {
  border-left: 4px solid var(--chatbot-info-500, #3b82f6);
  background: var(--chatbot-info-50, #eff6ff);
}

.severity-low .chatbot-error-title {
  color: var(--chatbot-info-700, #1d4ed8);
}

/* Medium severity - yellow/orange */
.severity-medium {
  border-left: 4px solid var(--chatbot-warning-500, #f59e0b);
  background: var(--chatbot-warning-50, #fffbeb);
}

.severity-medium .chatbot-error-title {
  color: var(--chatbot-warning-700, #b45309);
}

/* High severity - red */
.severity-high {
  border-left: 4px solid var(--chatbot-error-500, #ef4444);
  background: var(--chatbot-error-50, #fef2f2);
}

.severity-high .chatbot-error-title {
  color: var(--chatbot-error-700, #b91c1c);
}

/* Critical severity - dark red */
.severity-critical {
  border-left: 4px solid var(--chatbot-error-600, #dc2626);
  background: var(--chatbot-error-100, #fee2e2);
  border-color: var(--chatbot-error-200, #fecaca);
}

.severity-critical .chatbot-error-title {
  color: var(--chatbot-error-800, #991b1b);
}

/* =================================================================
   üìÑ ERROR HEADER
   ================================================================= */

.chatbot-error-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: var(--chatbot-spacing-md, 1rem);
}

.chatbot-error-title {
  font-size: var(--chatbot-text-lg, 1.125rem);
  font-weight: var(--chatbot-font-semibold, 600);
  margin: 0;
  color: var(--chatbot-text-primary, #111827);
  display: flex;
  align-items: center;
  gap: var(--chatbot-spacing-xs, 0.5rem);
}

.chatbot-error-progress {
  font-size: var(--chatbot-text-sm, 0.875rem);
  color: var(--chatbot-text-muted, #6b7280);
  background: var(--chatbot-bg-button-secondary, #f3f4f6);
  padding: var(--chatbot-spacing-xs, 0.25rem) var(--chatbot-spacing-sm, 0.5rem);
  border-radius: var(--chatbot-border-radius-sm, 0.375rem);
  font-weight: var(--chatbot-font-medium, 500);
}

.chatbot-error-close-button {
  background: none;
  border: none;
  font-size: var(--chatbot-text-xl, 1.25rem);
  cursor: pointer;
  color: var(--chatbot-text-muted, #6b7280);
  padding: var(--chatbot-spacing-xs, 0.25rem);
  border-radius: var(--chatbot-border-radius-sm, 0.375rem);
  transition: all 0.2s ease;
  min-width: 32px;
  min-height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.chatbot-error-close-button:hover,
.chatbot-error-close-button:focus {
  background: var(--chatbot-bg-button-secondary, #f3f4f6);
  color: var(--chatbot-text-primary, #111827);
  outline: none;
}

.chatbot-error-close-button:focus {
  box-shadow: 0 0 0 2px var(--chatbot-border-focus, #3b82f6);
}

/* =================================================================
   üí¨ ERROR MESSAGE
   ================================================================= */

.chatbot-error-message {
  font-size: var(--chatbot-text-base, 1rem);
  color: var(--chatbot-text-secondary, #4b5563);
  line-height: var(--chatbot-leading-relaxed, 1.625);
  margin-bottom: var(--chatbot-spacing-lg, 1.5rem);
}

/* =================================================================
   üéØ ERROR ACTIONS
   ================================================================= */

.chatbot-error-actions {
  display: flex;
  flex-direction: column;
  gap: var(--chatbot-spacing-md, 1rem);
  align-items: center;
}

.chatbot-error-countdown {
  font-size: var(--chatbot-text-sm, 0.875rem);
  color: var(--chatbot-text-muted, #6b7280);
  font-weight: var(--chatbot-font-medium, 500);
  padding: var(--chatbot-spacing-sm, 0.5rem) var(--chatbot-spacing-md, 1rem);
  background: var(--chatbot-bg-input, #f9fafb);
  border: 1px solid var(--chatbot-border-input, #d1d5db);
  border-radius: var(--chatbot-border-radius-md, 0.5rem);
  display: flex;
  align-items: center;
  gap: var(--chatbot-spacing-xs, 0.5rem);
}

.chatbot-error-countdown::before {
  content: '‚è±Ô∏è';
  font-size: var(--chatbot-text-base, 1rem);
}

.chatbot-error-retry-button {
  background: var(--chatbot-bg-button-primary, #3b82f6);
  color: var(--chatbot-text-inverted, #ffffff);
  border: none;
  padding: var(--chatbot-spacing-sm, 0.5rem) var(--chatbot-spacing-lg, 1.5rem);
  border-radius: var(--chatbot-border-radius-md, 0.5rem);
  font-size: var(--chatbot-text-sm, 0.875rem);
  font-weight: var(--chatbot-font-medium, 500);
  cursor: pointer;
  transition: all 0.2s ease;
  min-height: 40px;
  display: flex;
  align-items: center;
  gap: var(--chatbot-spacing-xs, 0.5rem);
}

.chatbot-error-retry-button:hover {
  background: var(--chatbot-primary-600, #2563eb);
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
}

.chatbot-error-retry-button:focus {
  outline: none;
  box-shadow: 0 0 0 2px var(--chatbot-border-focus, #3b82f6);
}

.chatbot-error-retry-button:active {
  transform: translateY(0);
}

.chatbot-error-retry-button:disabled {
  background: var(--chatbot-bg-button-secondary, #f3f4f6);
  color: var(--chatbot-text-muted, #6b7280);
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

/* =================================================================
   üé≠ SPECIFIC ERROR TYPES
   ================================================================= */

/* Rate Limit Error */
.chatbot-error-rate-limit .chatbot-error-title::before {
  content: '‚è±Ô∏è';
  margin-right: var(--chatbot-spacing-xs, 0.5rem);
}

.chatbot-error-rate-limit .chatbot-error-countdown {
  background: var(--chatbot-warning-100, #fef3c7);
  border-color: var(--chatbot-warning-300, #fcd34d);
  color: var(--chatbot-warning-800, #92400e);
}

/* Network Error */
.chatbot-error-network .chatbot-error-title::before {
  content: 'üåê';
  margin-right: var(--chatbot-spacing-xs, 0.5rem);
}

/* Server Error */
.chatbot-error-server .chatbot-error-title::before {
  content: '‚ö†Ô∏è';
  margin-right: var(--chatbot-spacing-xs, 0.5rem);
}

/* Authentication Error */
.chatbot-error-authentication .chatbot-error-title::before {
  content: 'üîê';
  margin-right: var(--chatbot-spacing-xs, 0.5rem);
}

/* Quota Exceeded */
.chatbot-error-quota .chatbot-error-title::before {
  content: 'üìä';
  margin-right: var(--chatbot-spacing-xs, 0.5rem);
}

/* Maintenance Mode */
.chatbot-error-maintenance .chatbot-error-title::before {
  content: 'üîß';
  margin-right: var(--chatbot-spacing-xs, 0.5rem);
}

.chatbot-error-maintenance {
  background: var(--chatbot-info-50, #eff6ff);
  border-color: var(--chatbot-info-200, #bfdbfe);
}

/* Timeout Error */
.chatbot-error-timeout .chatbot-error-title::before {
  content: '‚è∞';
  margin-right: var(--chatbot-spacing-xs, 0.5rem);
}

/* Max Retries Error */
.chatbot-error-max-retries .chatbot-error-title::before {
  content: '‚ùå';
  margin-right: var(--chatbot-spacing-xs, 0.5rem);
}

/* Generic Error */
.chatbot-error-generic .chatbot-error-title::before {
  content: '‚ùì';
  margin-right: var(--chatbot-spacing-xs, 0.5rem);
}

/* =================================================================
   üì± RESPONSIVE DESIGN
   ================================================================= */

@media (max-width: 480px) {
  .chatbot-error-overlay {
    padding: var(--chatbot-spacing-sm, 0.5rem);
  }
  
  .chatbot-error-content {
    padding: var(--chatbot-spacing-md, 1rem);
    min-width: auto;
    max-width: 95%;
  }
  
  .chatbot-error-header {
    flex-direction: column;
    gap: var(--chatbot-spacing-sm, 0.5rem);
    text-align: center;
  }
  
  .chatbot-error-close-button {
    position: absolute;
    top: var(--chatbot-spacing-sm, 0.5rem);
    right: var(--chatbot-spacing-sm, 0.5rem);
  }
  
  .chatbot-error-title {
    font-size: var(--chatbot-text-base, 1rem);
  }
  
  .chatbot-error-message {
    font-size: var(--chatbot-text-sm, 0.875rem);
  }
}

/* =================================================================
   üé® DARK MODE SUPPORT
   ================================================================= */

.theme-dark .chatbot-error-overlay {
  background: rgba(0, 0, 0, 0.9);
}

.theme-dark .chatbot-error-content {
  background: var(--chatbot-dark-bg-card, #1e293b);
  border-color: var(--chatbot-dark-border-color, #475569);
  color: var(--chatbot-dark-text-primary, #f8fafc);
}

.theme-dark .chatbot-error-title {
  color: var(--chatbot-dark-text-primary, #f8fafc);
}

.theme-dark .chatbot-error-message {
  color: var(--chatbot-dark-text-secondary, #cbd5e1);
}

.theme-dark .severity-low {
  background: rgba(59, 130, 246, 0.1);
  border-left-color: var(--chatbot-dark-info-400, #60a5fa);
}

.theme-dark .severity-medium {
  background: rgba(245, 158, 11, 0.1);
  border-left-color: var(--chatbot-dark-warning-400, #fbbf24);
}

.theme-dark .severity-high {
  background: rgba(239, 68, 68, 0.1);
  border-left-color: var(--chatbot-dark-error-400, #f87171);
}

.theme-dark .severity-critical {
  background: rgba(220, 38, 38, 0.15);
  border-left-color: var(--chatbot-dark-error-500, #ef4444);
}

/* =================================================================
   üîÜ HIGH CONTRAST MODE
   ================================================================= */

.high-contrast-mode .chatbot-error-overlay {
  background: rgba(0, 0, 0, 0.95);
}

.high-contrast-mode .chatbot-error-content {
  border-width: 2px;
  border-color: var(--chatbot-border-color, #000000);
}

.high-contrast-mode .chatbot-error-retry-button {
  border: 2px solid var(--chatbot-primary-500, #0066cc);
}

.high-contrast-mode .chatbot-error-retry-button:focus {
  outline: 3px solid var(--chatbot-border-focus, #0066cc);
  outline-offset: 2px;
}

.high-contrast-mode .chatbot-error-close-button:focus {
  outline: 2px solid var(--chatbot-border-focus, #0066cc);
  outline-offset: 2px;
}

/* =================================================================
   üñ•Ô∏è FORCED COLORS MODE
   ================================================================= */

@media (forced-colors: active) {
  .chatbot-error-overlay {
    background: Canvas;
    border: 2px solid ButtonText;
  }
  
  .chatbot-error-content {
    background: Canvas !important;
    border: 2px solid ButtonText !important;
    color: CanvasText !important;
  }
  
  .chatbot-error-title {
    color: CanvasText !important;
  }
  
  .chatbot-error-message {
    color: CanvasText !important;
  }
  
  .chatbot-error-retry-button {
    background: ButtonFace !important;
    color: ButtonText !important;
    border: 1px solid ButtonText !important;
  }
  
  .chatbot-error-retry-button:hover,
  .chatbot-error-retry-button:focus {
    background: Highlight !important;
    color: HighlightText !important;
  }
  
  .chatbot-error-countdown {
    background: Field !important;
    color: FieldText !important;
    border: 1px solid ButtonText !important;
  }
  
  /* Remove severity-based styling */
  .severity-low,
  .severity-medium,
  .severity-high,
  .severity-critical {
    background: Canvas !important;
    border-left: 4px solid ButtonText !important;
  }
}

/* =================================================================
   ‚ö° LOADING STATES
   ================================================================= */

.chatbot-error-loading {
  position: relative;
  overflow: hidden;
}

.chatbot-error-loading::after {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 2px;
  background: linear-gradient(
    90deg,
    transparent,
    var(--chatbot-primary-500, #3b82f6),
    transparent
  );
  animation: chatbotErrorProgress 2s infinite;
}

@keyframes chatbotErrorProgress {
  0% { left: -100%; }
  100% { left: 100%; }
}

/* Disable loading animation if reduced motion */
@media (prefers-reduced-motion: reduce) {
  .chatbot-error-loading::after {
    animation: none;
    display: none;
  }
}

/* =================================================================
   üé≠ ANIMATION UTILITIES
   ================================================================= */

/* Pulse animation for countdown */
.chatbot-error-countdown {
  animation: chatbotErrorPulse 2s infinite;
}

@keyframes chatbotErrorPulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

/* Shake animation for critical errors */
.severity-critical .chatbot-error-content {
  animation: chatbotErrorShake 0.5s ease-in-out;
}

@keyframes chatbotErrorShake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-2px); }
  75% { transform: translateX(2px); }
}

/* Disable animations for reduced motion */
@media (prefers-reduced-motion: reduce) {
  .chatbot-error-countdown {
    animation: none;
  }
  
  .severity-critical .chatbot-error-content {
    animation: none;
  }
}

/* =================================================================
   üîß UTILITY CLASSES
   ================================================================= */

/* Hide error overlay */
.chatbot-error-hidden {
  display: none !important;
}

/* Error state for main widget */
.chatbot-widget-error {
  pointer-events: none;
  opacity: 0.6;
}

/* Error badge for messages */
.chatbot-message-error {
  border-left: 3px solid var(--chatbot-error-500, #ef4444);
  background: var(--chatbot-error-50, #fef2f2);
}

.chatbot-message-error .chatbot-message-content {
  color: var(--chatbot-error-700, #b91c1c);
}
