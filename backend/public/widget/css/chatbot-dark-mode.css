/**
 * üåô Chatbot Widget - Dark Mode & High Contrast Styles
 * 
 * Supporto completo per:
 * - Dark mode automatico e manuale
 * - High contrast mode
 * - Forced colors mode (Windows High Contrast)
 * - Tema toggle UI
 * - Transizioni fluide
 * 
 * @version 1.0.0
 * @author Chatbot Platform
 */

/* =================================================================
   üåê CSS CUSTOM PROPERTIES BASE
   ================================================================= */

:root {
  /* Theme mode detection */
  --chatbot-theme-mode: light;
  --chatbot-contrast-mode: normal;
  
  /* Animation preferences */
  --chatbot-reduce-motion: 0;
  
  /* Theme transition timing */
  --chatbot-theme-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Detect user's motion preferences */
@media (prefers-reduced-motion: reduce) {
  :root {
    --chatbot-reduce-motion: 1;
  }
}

/* =================================================================
   ‚òÄÔ∏è LIGHT MODE STYLES (EXPLICIT)
   ================================================================= */

/* Explicit light mode when toggled manually or as default */
.chatbot-widget[data-theme="light"],
#chatbot-widget[data-theme="light"],
.chatbot-widget:not([data-theme]),
#chatbot-widget:not([data-theme]) {
  /* Background colors */
  --chatbot-bg-primary: #ffffff;
  --chatbot-bg-secondary: #f8fafc;
  --chatbot-bg-tertiary: #f1f5f9;
  --chatbot-bg-card: #ffffff;
  --chatbot-bg-input: #ffffff;
  
  /* Text colors */
  --chatbot-text-primary: #0f172a;
  --chatbot-text-secondary: #475569;
  --chatbot-text-tertiary: #64748b;
  --chatbot-text-inverse: #ffffff;
  
  /* Border colors */
  --chatbot-border-primary: #e2e8f0;
  --chatbot-border-secondary: #cbd5e1;
  
  /* Message colors */
  --chatbot-message-user-bg: #3b82f6;
  --chatbot-message-user-text: #ffffff;
  --chatbot-message-bot-bg: #f1f5f9;
  --chatbot-message-bot-text: #0f172a;
  
  /* Button colors */
  --chatbot-button-primary-bg: #3b82f6;
  --chatbot-button-primary-text: #ffffff;
  --chatbot-button-primary-hover: #2563eb;
  
  /* Citation colors */
  --chatbot-citation-bg: #f8fafc;
  --chatbot-citation-border: #e2e8f0;
  --chatbot-citation-text: #475569;
  
  /* Primary colors */
  --chatbot-primary-500: #3b82f6;
  --chatbot-primary-600: #2563eb;
  
  /* Neutral colors */
  --chatbot-neutral-300: #d1d5db;
  --chatbot-neutral-400: #9ca3af;
  
  /* Focus colors */
  --chatbot-focus-ring-color: #3b82f6;
  
  /* Shadows */
  --chatbot-shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
}

/* Force light mode to override any system dark preferences */
.chatbot-widget[data-theme="light"] {
  color-scheme: light !important;
}

.chatbot-widget[data-theme="dark"] {
  color-scheme: dark !important;
}

/* =================================================================
   üåô DARK MODE STYLES  
   ================================================================= */

/* Auto dark mode based on system preference */
@media (prefers-color-scheme: dark) {
  .theme-auto #chatbot-container,
  .theme-auto #chatbot-fab {
    /* Background colors */
    --chatbot-bg-body: var(--chatbot-dark-bg-body, #0f172a);
    --chatbot-bg-card: var(--chatbot-dark-bg-card, #1e293b);
    --chatbot-bg-input: var(--chatbot-dark-bg-input, #334155);
    --chatbot-bg-button-primary: var(--chatbot-dark-primary-500, #3b82f6);
    --chatbot-bg-button-secondary: var(--chatbot-dark-bg-button-secondary, #475569);
    --chatbot-bg-button-ghost: var(--chatbot-dark-bg-button-ghost, transparent);
    --chatbot-bg-user-message: var(--chatbot-dark-primary-500, #3b82f6);
    --chatbot-bg-bot-message: var(--chatbot-dark-bg-card, #1e293b);
    --chatbot-bg-header: var(--chatbot-dark-primary-600, #2563eb);
    --chatbot-bg-fab: var(--chatbot-dark-primary-500, #3b82f6);
    
    /* Text colors */
    --chatbot-text-primary: var(--chatbot-dark-text-primary, #f8fafc);
    --chatbot-text-secondary: var(--chatbot-dark-text-secondary, #cbd5e1);
    --chatbot-text-muted: var(--chatbot-dark-text-muted, #94a3b8);
    --chatbot-text-inverted: var(--chatbot-dark-text-inverted, #0f172a);
    --chatbot-text-link: var(--chatbot-dark-primary-400, #60a5fa);
    --chatbot-text-error: var(--chatbot-dark-error-400, #f87171);
    --chatbot-text-success: var(--chatbot-dark-success-400, #4ade80);
    
    /* Border colors */
    --chatbot-border-color: var(--chatbot-dark-border-color, #475569);
    --chatbot-border-input: var(--chatbot-dark-border-input, #64748b);
    --chatbot-border-focus: var(--chatbot-dark-primary-400, #60a5fa);
    
    /* Shadow colors */
    --chatbot-shadow-color: var(--chatbot-dark-shadow-color, rgba(0, 0, 0, 0.5));
    --chatbot-shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
    --chatbot-shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
    --chatbot-shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
  }
}

/* Manual dark mode */
.theme-dark #chatbot-container,
.theme-dark #chatbot-fab,
.chatbot-widget[data-theme="dark"],
#chatbot-widget[data-theme="dark"] {
  /* Background colors */
  --chatbot-bg-body: var(--chatbot-dark-bg-body, #0f172a);
  --chatbot-bg-card: var(--chatbot-dark-bg-card, #1e293b);
  --chatbot-bg-input: var(--chatbot-dark-bg-input, #334155);
  --chatbot-bg-button-primary: var(--chatbot-dark-primary-500, #3b82f6);
  --chatbot-bg-button-secondary: var(--chatbot-dark-bg-button-secondary, #475569);
  --chatbot-bg-button-ghost: var(--chatbot-dark-bg-button-ghost, transparent);
  --chatbot-bg-user-message: var(--chatbot-dark-primary-500, #3b82f6);
  --chatbot-bg-bot-message: var(--chatbot-dark-bg-card, #1e293b);
  --chatbot-bg-header: var(--chatbot-dark-primary-600, #2563eb);
  --chatbot-bg-fab: var(--chatbot-dark-primary-500, #3b82f6);
  
  /* Text colors */
  --chatbot-text-primary: var(--chatbot-dark-text-primary, #f8fafc);
  --chatbot-text-secondary: var(--chatbot-dark-text-secondary, #cbd5e1);
  --chatbot-text-muted: var(--chatbot-dark-text-muted, #94a3b8);
  --chatbot-text-inverted: var(--chatbot-dark-text-inverted, #0f172a);
  --chatbot-text-link: var(--chatbot-dark-primary-400, #60a5fa);
  --chatbot-text-error: var(--chatbot-dark-error-400, #f87171);
  --chatbot-text-success: var(--chatbot-dark-success-400, #4ade80);
  
  /* Border colors */
  --chatbot-border-color: var(--chatbot-dark-border-color, #475569);
  --chatbot-border-input: var(--chatbot-dark-border-input, #64748b);
  --chatbot-border-focus: var(--chatbot-dark-primary-400, #60a5fa);
  
  /* Shadow colors */
  --chatbot-shadow-color: var(--chatbot-dark-shadow-color, rgba(0, 0, 0, 0.5));
  --chatbot-shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
  --chatbot-shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
  --chatbot-shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
}

/* =================================================================
   üîÜ HIGH CONTRAST MODE
   ================================================================= */

@media (prefers-contrast: high) {
  .theme-auto #chatbot-container,
  .theme-auto #chatbot-fab,
  .theme-light #chatbot-container,
  .theme-light #chatbot-fab {
    /* Light high contrast */
    --chatbot-text-primary: #000000;
    --chatbot-text-secondary: #333333;
    --chatbot-text-muted: #666666;
    --chatbot-bg-body: #ffffff;
    --chatbot-bg-card: #ffffff;
    --chatbot-bg-input: #ffffff;
    --chatbot-border-color: #000000;
    --chatbot-border-input: #000000;
    --chatbot-primary-500: #0066cc;
    --chatbot-primary-600: #0052a3;
    --chatbot-shadow-sm: 0 2px 4px 0 rgba(0, 0, 0, 0.5);
    --chatbot-shadow-md: 0 4px 8px 0 rgba(0, 0, 0, 0.5);
    --chatbot-shadow-lg: 0 8px 16px 0 rgba(0, 0, 0, 0.5);
  }
  
  .theme-auto #chatbot-container,
  .theme-auto #chatbot-fab,
  .theme-dark #chatbot-container,
  .theme-dark #chatbot-fab {
    /* Dark high contrast */
    --chatbot-text-primary: #ffffff;
    --chatbot-text-secondary: #e0e0e0;
    --chatbot-text-muted: #cccccc;
    --chatbot-bg-body: #000000;
    --chatbot-bg-card: #1a1a1a;
    --chatbot-bg-input: #1a1a1a;
    --chatbot-border-color: #ffffff;
    --chatbot-border-input: #ffffff;
    --chatbot-primary-500: #0099ff;
    --chatbot-primary-600: #0088ee;
  }
}

@media (prefers-color-scheme: dark) and (prefers-contrast: high) {
  .theme-auto #chatbot-container,
  .theme-auto #chatbot-fab {
    /* Dark high contrast */
    --chatbot-text-primary: #ffffff;
    --chatbot-text-secondary: #e0e0e0;
    --chatbot-text-muted: #cccccc;
    --chatbot-bg-body: #000000;
    --chatbot-bg-card: #1a1a1a;
    --chatbot-bg-input: #1a1a1a;
    --chatbot-border-color: #ffffff;
    --chatbot-border-input: #ffffff;
    --chatbot-primary-500: #0099ff;
    --chatbot-primary-600: #0088ee;
  }
}

/* Manual high contrast modes */
.high-contrast-mode #chatbot-container,
.high-contrast-mode #chatbot-fab {
  /* Increase border visibility */
  --chatbot-border-width: 2px;
  
  /* Enhanced focus indicators */
  --chatbot-focus-ring-width: 3px;
  --chatbot-focus-ring-offset: 2px;
}

.theme-light.high-contrast-mode #chatbot-container,
.theme-light.high-contrast-mode #chatbot-fab {
  /* Light high contrast overrides */
  --chatbot-text-primary: #000000;
  --chatbot-text-secondary: #333333;
  --chatbot-text-muted: #666666;
  --chatbot-bg-body: #ffffff;
  --chatbot-bg-card: #ffffff;
  --chatbot-bg-input: #ffffff;
  --chatbot-border-color: #000000;
  --chatbot-border-input: #000000;
  --chatbot-primary-500: #0066cc;
  --chatbot-primary-600: #0052a3;
}

.theme-dark.high-contrast-mode #chatbot-container,
.theme-dark.high-contrast-mode #chatbot-fab {
  /* Dark high contrast overrides */
  --chatbot-text-primary: #ffffff;
  --chatbot-text-secondary: #e0e0e0;
  --chatbot-text-muted: #cccccc;
  --chatbot-bg-body: #000000;
  --chatbot-bg-card: #1a1a1a;
  --chatbot-bg-input: #1a1a1a;
  --chatbot-border-color: #ffffff;
  --chatbot-border-input: #ffffff;
  --chatbot-primary-500: #0099ff;
  --chatbot-primary-600: #0088ee;
}

/* =================================================================
   üñ•Ô∏è FORCED COLORS MODE (Windows High Contrast)
   ================================================================= */

@media (forced-colors: active) {
  .theme-forced-colors #chatbot-container,
  .theme-forced-colors #chatbot-fab,
  #chatbot-container,
  #chatbot-fab {
    /* Use system colors */
    --chatbot-text-primary: CanvasText;
    --chatbot-text-secondary: GrayText;
    --chatbot-text-muted: GrayText;
    --chatbot-text-inverted: HighlightText;
    --chatbot-text-link: LinkText;
    --chatbot-text-error: CanvasText;
    --chatbot-text-success: CanvasText;
    
    --chatbot-bg-body: Canvas;
    --chatbot-bg-card: Canvas;
    --chatbot-bg-input: Field;
    --chatbot-bg-button-primary: ButtonFace;
    --chatbot-bg-button-secondary: ButtonFace;
    --chatbot-bg-button-ghost: Canvas;
    --chatbot-bg-user-message: Highlight;
    --chatbot-bg-bot-message: Canvas;
    --chatbot-bg-header: Highlight;
    --chatbot-bg-fab: ButtonFace;
    
    --chatbot-border-color: ButtonText;
    --chatbot-border-input: ButtonText;
    --chatbot-border-focus: Highlight;
    
    --chatbot-primary-500: Highlight;
    --chatbot-primary-600: Highlight;
    
    /* Remove shadows in forced colors mode */
    --chatbot-shadow-sm: none;
    --chatbot-shadow-md: none;
    --chatbot-shadow-lg: none;
    
    /* Force borders to be visible */
    border: 1px solid ButtonText !important;
  }
  
  /* Special handling for buttons in forced colors */
  .theme-forced-colors .chatbot-button,
  .chatbot-button {
    background: ButtonFace !important;
    color: ButtonText !important;
    border: 1px solid ButtonText !important;
  }
  
  .theme-forced-colors .chatbot-button:hover,
  .theme-forced-colors .chatbot-button:focus,
  .chatbot-button:hover,
  .chatbot-button:focus {
    background: Highlight !important;
    color: HighlightText !important;
    border-color: HighlightText !important;
  }
  
  /* Input fields */
  .theme-forced-colors .chatbot-input,
  .chatbot-input {
    background: Field !important;
    color: FieldText !important;
    border: 1px solid ButtonText !important;
  }
  
  /* Links */
  .theme-forced-colors .chatbot-link,
  .chatbot-link {
    color: LinkText !important;
  }
  
  .theme-forced-colors .chatbot-link:visited,
  .chatbot-link:visited {
    color: VisitedText !important;
  }
}

/* =================================================================
   üé® THEME TOGGLE BUTTON
   ================================================================= */

.chatbot-theme-toggle {
  background: none;
  border: none;
  font-size: 1.25rem;
  cursor: pointer;
  padding: var(--chatbot-spacing-xs, 0.5rem);
  border-radius: var(--chatbot-border-radius-sm, 0.375rem);
  transition: all 0.2s ease;
  min-width: 32px;
  min-height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: var(--chatbot-spacing-xs, 0.5rem);
  color: var(--chatbot-text-primary);
  position: relative;
}

.chatbot-theme-toggle:hover {
  background-color: rgba(255, 255, 255, 0.2);
  transform: scale(1.05);
}

.chatbot-theme-toggle:focus {
  outline: none;
  background-color: rgba(255, 255, 255, 0.2);
  box-shadow: 0 0 0 var(--chatbot-focus-ring-width, 2px) var(--chatbot-border-focus);
}

.chatbot-theme-toggle:active {
  transform: scale(0.95);
}

/* High contrast toggle button */
.high-contrast-mode .chatbot-theme-toggle {
  border: var(--chatbot-border-width, 2px) solid var(--chatbot-border-color);
  background-color: var(--chatbot-bg-button-secondary);
}

.high-contrast-mode .chatbot-theme-toggle:hover,
.high-contrast-mode .chatbot-theme-toggle:focus {
  background-color: var(--chatbot-primary-500);
  color: var(--chatbot-text-inverted);
  border-color: var(--chatbot-primary-500);
}

/* Forced colors toggle button */
.theme-forced-colors .chatbot-theme-toggle {
  border: 1px solid ButtonText !important;
  background-color: ButtonFace !important;
  color: ButtonText !important;
}

.theme-forced-colors .chatbot-theme-toggle:hover,
.theme-forced-colors .chatbot-theme-toggle:focus {
  background-color: Highlight !important;
  color: HighlightText !important;
  border-color: HighlightText !important;
}

/* Disabled state */
.chatbot-theme-toggle:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.chatbot-theme-toggle:disabled:hover {
  background-color: transparent;
  transform: none;
}

/* =================================================================
   üé≠ SMOOTH TRANSITIONS
   ================================================================= */

/* Respect user's motion preferences */
@media (prefers-reduced-motion: no-preference) {
  #chatbot-container,
  #chatbot-fab,
  .chatbot-message,
  .chatbot-button,
  .chatbot-input,
  .chatbot-theme-toggle {
    transition: 
      background-color 0.3s ease,
      border-color 0.3s ease,
      color 0.3s ease,
      box-shadow 0.3s ease,
      opacity 0.3s ease;
  }
}

/* Reduce animations for accessibility */
@media (prefers-reduced-motion: reduce) {
  #chatbot-container,
  #chatbot-fab,
  .chatbot-message,
  .chatbot-button,
  .chatbot-input,
  .chatbot-theme-toggle {
    transition: none;
    animation: none;
  }
}

/* =================================================================
   üîß THEME UTILITIES
   ================================================================= */

/* Theme-aware visibility */
.light-only {
  display: initial;
}

.dark-only {
  display: none;
}

.theme-dark .light-only {
  display: none;
}

.theme-dark .dark-only {
  display: initial;
}

@media (prefers-color-scheme: dark) {
  .theme-auto .light-only {
    display: none;
  }
  
  .theme-auto .dark-only {
    display: initial;
  }
}

/* High contrast indicators */
.high-contrast-only {
  display: none;
}

.high-contrast-mode .high-contrast-only {
  display: initial;
}

.high-contrast-mode .normal-contrast-only {
  display: none;
}

/* Forced colors indicators */
.forced-colors-only {
  display: none;
}

.theme-forced-colors .forced-colors-only {
  display: initial;
}

.theme-forced-colors .normal-colors-only {
  display: none;
}

/* =================================================================
   üì± RESPONSIVE DARK MODE
   ================================================================= */

/* Adjust shadows for mobile in dark mode */
@media (max-width: 768px) {
  .theme-dark #chatbot-container,
  .theme-auto #chatbot-container {
    --chatbot-shadow-lg: 0 8px 20px -4px rgba(0, 0, 0, 0.6);
  }
}

/* =================================================================
   üé≠ THEME TRANSITION ANIMATIONS
   ================================================================= */

/* Smooth transition for theme changes */
.chatbot-widget.theme-transition,
.chatbot-widget.theme-transition * {
  transition: var(--chatbot-theme-transition) !important;
}

/* Disable transitions for users who prefer reduced motion */
@media (prefers-reduced-motion: reduce) {
  .chatbot-widget.theme-transition,
  .chatbot-widget.theme-transition * {
    transition: none !important;
  }
}

/* Specific properties that should transition */
.chatbot-widget {
  transition: 
    background-color 0.3s ease,
    border-color 0.3s ease,
    box-shadow 0.3s ease;
}

.chatbot-widget *:not(.chatbot-theme-icon) {
  transition: 
    background-color 0.3s ease,
    color 0.3s ease,
    border-color 0.3s ease;
}

/* =================================================================
   ‚ö° PERFORMANCE OPTIMIZATIONS
   ================================================================= */

/* Use will-change for elements that transition themes */
.chatbot-theme-toggle,
#chatbot-container,
#chatbot-fab {
  will-change: background-color, border-color, color;
}

/* GPU acceleration for smooth transitions */
@media (prefers-reduced-motion: no-preference) {
  .chatbot-theme-toggle {
    transform: translateZ(0);
    backface-visibility: hidden;
  }
}

/* =================================================================
   üêõ BROWSER-SPECIFIC FIXES
   ================================================================= */

/* Safari dark mode fix */
@supports (-webkit-appearance: none) {
  .theme-dark input[type="text"],
  .theme-dark textarea {
    -webkit-appearance: none;
    appearance: none;
  }
}

/* Edge forced colors mode fix */
@supports (-ms-high-contrast: active) {
  .chatbot-button {
    border: 1px solid ButtonText;
  }
}

/* Firefox focus ring enhancement */
@-moz-document url-prefix() {
  .chatbot-theme-toggle:focus {
    outline: 2px solid -moz-focusring;
    outline-offset: 2px;
  }
}
